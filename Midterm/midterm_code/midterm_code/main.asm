.include "m328pdef.inc"
.def clear_in = R16
.def counter = R17
.def temp = R18
.def input = R19
.equ input8bit = 0x00
.equ output8bit = 0xFF
.equ up_btn = 0x20
.equ rst_btn = 0x40
.equ dwn_btn = 0x80

.cseg
.org 0x0000 ;________________________________________________
	rjmp SETUP ;________________________________________________
SETUP:
	ldi temp, 0xFF ;________________________________________________
	out DDRB, temp ;________________________________________________
	ldi temp, 0x00 ;________________________________________________
	out DDRD, temp ;________________________________________________
	ldi counter, 0x00 ;________________________________________________
	ldi clear_in, 0b11100000 ;________________________________________________
MAIN_LOOP:
	in input, PIND ;________________________________________________
	and input, clear_in ;________________________________________________
	cpi input, rst_btn ;________________________________________________
	breq RESET ;________________________________________________
	cpi input, up_btn ;________________________________________________
	breq UP_VAL ;________________________________________________
	cpi input, dwn_btn ;________________________________________________
	breq DOWN_VAL ;________________________________________________
SHOW_OUT: ;________________________________________________
	mov temp, counter ;________________________________________________
	out PORTB, temp ;________________________________________________
	rjmp MAIN_LOOP ;________________________________________________
DELAY_F:
	ldi r31,41 ;________________________________________________
	ldi r30,150 ;________________________________________________
	ldi r20, 128 ;________________________________________________
L1: dec r20 ;________________________________________________
	brne L1 ;________________________________________________
	dec r30 ;________________________________________________
	brne L1 ;________________________________________________
	dec r31 ;________________________________________________
	brne L1 ;________________________________________________
	ret 

RESET:
	ldi counter, 0x00 ;________________________________________________
	rcall DELAY_F ;________________________________________________
	rjmp SHOW_OUT ;________________________________________________
UP_VAL:
	inc counter ;________________________________________________
	call DELAY_F ;________________________________________________
	rjmp SHOW_OUT ;________________________________________________
DOWN_VAL:
	dec counter ;________________________________________________
	rcall DELAY_F ;________________________________________________
	rjmp SHOW_OUT ;________________________________________________
