.include "m328pdef.inc"				;??????????????????????????????????? m328pdef.inc
.def clear_in = R16					;????????????????????? R16 ????????????? clear_in
.def counter = R17					;????????????????????? R17 ????????????? counter
.def temp = R18						;????????????????????? R18 ????????????? temp
.def input = R19					;????????????????????? R19 ????????????? input
.equ input8bit = 0x00				;????????????????????????????????????????????? 8 ???
.equ output8bit = 0xFF				;????????????????????????????????????????????? 8 ???
.equ up_btn = 0x20					;???????? up_btn ?????????? 0x20
.equ rst_btn = 0x40					;???????? rst_btn ?????????? 0x40
.equ dwn_btn = 0x80					;???????? dwn_btn ?????????? 0x80

.cseg								;???????? code segment
.org 0x0000							;?????????????????????????????? 0x0000
	rjmp SETUP						;???????????????? SETUP
SETUP:								;??????????????????????????????????????????
	ldi temp, output8bit			;?????????????????????????????????????? 8 ???
	out DDRB, temp					;????????????? B ???????????????? 8 ???
	ldi temp, input8bit				;???????????????????????????????????? 8 ???
	out DDRD, temp					;????????????? D ?????????????? 8 ???
	ldi counter, 0x00				;????????????????????????? counter ????? 0
	ldi clear_in, 0b11100000		;?????????????? clear_in ????????? 0b11100000
MAIN_LOOP:							;???????????????????????????
	in input, PIND					;?????????? PIND ?????????????? input
	and input, clear_in				;?????????????????????????????????????
	cpi input, rst_btn				;??????????????????????????????????? rst_btn ???????
	breq RESET						;?????? ?????????????????????????? RESET
	cpi input, up_btn				;??????????????????????????????????? up_btn ???????
	breq UP_VAL						;?????? ?????????????????????????? UP_VAL
	cpi input, dwn_btn				;??????????????????????????????????? dwn_btn ???????
	breq DOWN_VAL					;?????? ?????????????????????????? DOWN_VAL
SHOW_OUT:							;??????????????????????????????????? LED
	mov temp, counter				;????????? counter ??????????? temp
	out PORTB, temp					;??????????????? temp ??????????? PORTB
	rjmp MAIN_LOOP					;???????????????????? MAIN_LOOP
DELAY_F:							;?????????????? ??????????????????
	ldi r31,41						;??????????? R31 ???????????? 41
	ldi r30,150						;??????????? R30 ???????????? 150
	ldi r20, 128					;??????????? R20 ???????????? 128
L1: dec r20							;??????? R20 ?? 1 ???
	brne L1							;???????? R20 ?????????? 0 ??????????????? L1
	dec r30							;????? R30 ?? 1 ???
	brne L1							;???????? R30 ?????????? 0 ??????????????? L1
	dec r31							;????? R31 ?? 1 ???
	brne L1							;???????? R31 ?????????? 0 ??????????????? L1
	ret								;????????????????????????????? Subroutine call 

RESET:								;???????????? ???? rst_btn ?????
	ldi counter, 0x00				;????????????????? counter ??????????????? 0
	rcall DELAY_F					;???????? subroutine ???? DELAY_F
	rjmp SHOW_OUT					;?????????????????????????????????????? LED
UP_VAL:
	inc counter						;???????????????? counter ???? 1 ???
	call DELAY_F					;???????? subroutine ???? DELAY_F
	rjmp SHOW_OUT					;?????????????????????????????????????? LED
DOWN_VAL:
	dec counter						;????????????? counter ?? 1 ??? 
	rcall DELAY_F					;???????? subroutine ???? DELAY_F
	rjmp SHOW_OUT					;?????????????????????????????????????? LED
